<!DOCTYPE html>
<html>
    <head>
        <title>Sorting Algorithm Visualisation</title>
        <style>
body {
    overflow: hidden;
}
* { margin:0; padding:0; } /* to remove the top and left whitespace */

html, body { width:100%; height:100%; } /* just to be sure these are full screen*/

canvas { display:block; } /* To remove the scrollbars */

        </style>
    </head>
    <body>
        <canvas id="mainCanvas"></canvas>
        <script>
(function() {
    var algorithmName, displayText, drawDelay, canvas, context, drawLoop, max,  doneIndex;
    var reads = 0, writes = 0, currentArray = [], readwritesHistory = [], algorithms = {
        "Bogo": bogo,
        "Bubble": bubble,
        "Gnome": gnome,
        "Selection": selection,
        "Counting": counting
    };

    init();

    function init() {
        var tempName = getParameterByName("algo");
        algorithmName = tempName ? tempName.charAt(0).toUpperCase() + tempName.slice(1).toLowerCase() : "Counting";
        displayText = "Click Anywhere - " + algorithmName + " Sort";
        var tempDelay = parseInt(getParameterByName("d"));
        drawDelay =  tempDelay < 10 ? 10 : tempDelay;
        canvas = document.getElementById("mainCanvas");
        context = canvas.getContext("2d");
        addRunListener();
        resizeCanvas();
        window.onresize = () => resizeCanvas();
    }

    function addRunListener() {
        canvas.onclick = () => run(algorithms[algorithmName]);
    }

    function addPauseListener() {
        canvas.onclick = () => {stopDrawLoop(); addResumeListener();};
    }

    function addResumeListener() {
        canvas.onclick = () => {startDrawLoop(); addPauseListener();};
    }

    function startDrawLoop() {
        drawLoop = setInterval(() => drawArray(false), drawDelay);
    }

    function stopDrawLoop() {
        clearInterval(drawLoop);
    }

    function run(algorithm) {
        readwritesHistory = [];
        doneIndex = reads = writes = 0;
        //Generate an array of random numbers, range 100-10000 inclusive
        var array = Array.from({length: parseInt(getParameterByName("n")) || 1500}, () => Math.floor(100 + Math.random() * 9899));
        //array.sort((a, b) => a - b);
        currentArray = (array.slice());
        max = Math.max(...array);
        addPauseListener();
        algorithm(array);
        startDrawLoop();
    }

    function bubble(array) {
        var tempArrayLength = array.length;
        var swapped = true;
        while (swapped) {
            swapped = false;
            for (let i = 0; i < tempArrayLength-1; i++) {
                if (compare(i, i+1, array) == 1) {
                    swapped = true;
                    swap(i, i+1, array);
                }
            }
            tempArrayLength--;
        }
    }

    function bogo(array) {
        var l = array.length;
        function isSorted(array) {
            for (let i = 0; i < l - 1; i++) {
                if (compare(i, i+1, array) == 1) return false;
            }
            return true;
        }

        while (!isSorted(array)) {
            for (let i = 0; i < l - 1; i++) {
                let i1 = Math.floor(Math.random() * l), i2 = Math.floor(Math.random() * l);
                swap(i1, i2, array);
            }
        }
    }

    function gnome(array) {
        for (let l = array.length, i = 1; i < l; i++) {
            for (let tempI = i; tempI > 0 && compare(tempI-1, tempI, array) == 1; tempI--) {
                swap(tempI-1, tempI, array);
            }
        }
    }

    function selection(array) {
        var l = array.length;
        for (let i1 = 0; i1 < l - 1; i1++) {
            let minI = i1;
            for (let i2 = i1 + 1; i2 < l; i2++) {
                if (compare(minI, i2, array) == 1) minI = i2;
            }
            if (minI != i1) swap(i1, minI, array);
        }
    }

    function counting(array) {
        var countArray = new Array(10000).fill(0), currentIndex = 0;
        for (let l = array.length, i = 0; i < l; i++) {
            countArray[read(i, array)]++;
        }

        for (let i = 100; i < 10001; i++) {
            while (countArray[i] > 0) {
                write(currentIndex++, i, array);
                countArray[i]--;
            }
        }
    }

    function read(i, array) {
        readwritesHistory.push([{type: 0, index: i}]);
        return array[i];
    }

    function write(i, v, array) {
        readwritesHistory.push([{type: 1, index: i, value: v}]);
        array[i] = v;
    }

    //Returns: -1=array[i1]<array[i2], 0=array[i1]==array[i2], 1=array[i1]>array[i2]
    function compare(i1, i2, array) {
        readwritesHistory.push([{type: 0, index: i1}, {type: 0, index: i2}]);
        var v1 = array[i1], v2 = array[i2];
        return v1 > v2 ? 1 : v1 == v2 ? 0 : -1;
    }

    function swap(i1, i2, array) {
        var temp = array[i1];
        array[i1] = array[i2];
        array[i2] = temp;
        readwritesHistory.push([{type: 1, index: i1, value: array[i1]}, {type:1, index: i2, value: array[i2]}]);
    }

    function drawArray(resize) {
        var l = currentArray.length, barWidth = canvas.width / l;
        context.fillStyle = "#000";
        context.fillRect(0, 0, canvas.width, canvas.height);

        if (!resize) {
            if (readwritesHistory.length > 0) {
                this.readwrites = readwritesHistory.shift();
                //0: read, 1: write
                for (let l = readwrites.length, i = 0; i < l; i++) {
                    let readwrite = readwrites[i];
                    if (readwrite.type == 1) {
                        writes++;
                        currentArray[readwrite.index] = readwrite.value;
                    } else reads++;
                }
            } else if (doneIndex < l) {
                this.readwrites = null;
                doneIndex++;
            } else {
                stopDrawLoop();
                addRunListener();
            }
        }

        for (let i = 0; i < l; i++) {
            drawBar(i, currentArray[i], barWidth, i < doneIndex ? "#00ff00" : "#fff", max);
        }

        if (this.readwrites) {
            for (let l = readwrites.length, i = 0; i < l; i++) {
                let readwrite = readwrites[i],
                    color = readwrite.type === 0 ? "#0000ff" : "#ff0000";
                drawBar(readwrite.index, currentArray[readwrite.index], barWidth, color, max);
            }
        }

        context.font = "30px Arial";
        context.fillStyle = "#fff";
        context.fillText(displayText, 50, 50);
        context.fillStyle = "#0000ff";
        context.fillText(reads + " Reads", 50, 110);
        context.fillStyle = "#ff0000";
        context.fillText(writes + " Writes", 50, 170);
    }

    function drawBar(index, value, barWidth, color, max) {
        var scaledHeight = (value / max) * canvas.height;
        context.fillStyle = color;
        context.fillRect(index * barWidth, canvas.height - scaledHeight, barWidth, scaledHeight);
    }

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawArray(true);
    }

    //https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
    function getParameterByName(name) {
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(window.location.href);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
})();
        </script>
    </body>
</html>
